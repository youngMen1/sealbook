# 1.接口返回设计建议

我们知道，对于接口方法的返回值和异常处理，最重要的是需要遵循方法的语义进行设计。以下  
是我梳理的一些设计上的原则和建议。

## 1.1.对响应合理分类

接口响应按有业务结果和未知业务结果分类，业务结果不管是业务成功还是业务规则导致的失败，都通过返回值返  
回；未知结果一般是系统性的异常导致，不要通过返回值错误码表达，而是通过抛出异常来表达。这里最关键一点  
，就是如何理解和区分某个“失败”是属于业务失败，还是属于系统异常。由于有时候这个区分并不是很容易，我  
们可以有一个比较简单的判断标准来确定：  
1.如果一个错误，调用方只能通过人工介入的方式才能恢复，比如修改代码、改配置，或数据订正等处理，则必  
然属于异常  
 2.如果调用方无法使用代码逻辑处理消化使得自动恢复，而是只能通过重试的方式，依赖下游的恢复才能恢复，  
则属于异常

## 1.2.异常处理机制
### 1.2.1.异常错误码
前面我们讲到，即便是抛异常的形式，我们也可以为我们的异常类设计错误码，异常错误码的增加会很快，往往也
和当前业务语义无关，因此千万不要和业务失败的错误码定义在一起。异常内的错误码主要用于日志、监控等，核
心原则就是，要方便定位问题。
### 1.2.2.避免层层try catch
到处充满异常处理的代码，会导致整个程序可读性变差，写起来也非常繁琐，可以遵循一定的原则：
 1.在原始发生错误的地方try catch，比如调用HSF接口的Facade层代码，主要目的是为了记录原始的错误以及
出入参，方便定位问题，一般会打日志，并转换成本应用的异常类上抛
 2.在应用的最顶层catch异常，打印统一日志，并根据“为什么针对HSF？”小节中的建议，处理成合适的异常
后再抛出。对于HSF接口，可以直接实现HSF的“ServerFilter”来统一在框架层面处理。
 3.中间层的代码，不必再层层catch，比如domain层，可以让代码逻辑更加清晰。
 
 ### 1.2.3.异常错误码
抛异常的场景，除了前面说的系统性异常外，参数错误也推荐使用异常。原因如下：
 1.参数正确一般是我们当前上下文执行的前提条件，我们一般可以使用assert来保证其正确。即我们的后续逻辑
是认为，当前的参数是不可能错误的，我们没必要为此写过多繁琐的防御性代码。
 2.一旦发生参数错误，则一定是调用方有代码bug，或者配置bug，应该通过抛出异常的方式，充分提前在开发
或测试阶段暴露。
 3.参数错误对调用方来说，是无法处理的，程序不可能自动恢复，一定是会需要人工介入才可能恢复，调用方不
可能会“判断如果是xx参数错误，我就做某个业务逻辑”这样的代码，因此通过返回值定义参数错误码没有意义。
# 2.参考

阿里技术2021技术人的百宝黑皮书.pdf

