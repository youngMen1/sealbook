
# 1.RabbitMQ高级特性--幂等性概念

## 1.1.幂等性是什么？
简单来说就是用户对于同一操作发起的一次请求或者多次请求的结果是一致的。
我们可以借鉴数据库的乐观锁机制来举个例子
* 首先为表添加一个版本字段version
* 在执行更新操作前呢，会先去数据库查询这个version
* 然后执行更新语句，以version作为条件，例如：
```
UPDATE T_REPS SET COUNT = COUNT -1，VERSION = VERSION + 1 WHERE VERSION = 1
```
* 如果执行更新时有其他人先更新了这张表的数据，那么这个条件就不生效了，也就不会执行操作了，通过这种乐观锁的机制来保障幂等性。

## 消费端-幂等性保障
### 什么情况下会出现重复消费？
当消费者消费完消息时，在给生产端返回ack时由于网络中断，导致生产端未收到确认信息，该条消息会重新发送并被消费者消费，但实际上该消费者已成功消费了该条消息，这就是重复消费问题。

### 如何避免消息的重复消费问题？
消费端实现幂等性，就意味着，我们的消息永远不会消费多次，即使我们收到了多条一样的消息

业界主流的幂等性操作：

##### 1.唯一ID + 指纹码机制，利用数据库主键去重
##### 2.利用Redis的原子性去实现


# 2.RabbitMQ解决消息幂等性问题





